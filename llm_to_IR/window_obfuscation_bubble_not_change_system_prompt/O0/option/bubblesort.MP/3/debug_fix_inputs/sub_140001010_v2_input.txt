; === ERROR LOG BEGIN [llvm-as] ===
; ../../llm_to_IR/window_obfuscation_bubble_not_change_system_prompt/O0/option/bubblesort.MP/3/sub_1400010101.ll:7:29: warning: ptr type is only supported in -opaque-pointers mode
; declare void @sub_140002790(ptr)
;                             ^
; llvm-as-14: ../../llm_to_IR/window_obfuscation_bubble_not_change_system_prompt/O0/option/bubblesort.MP/3/sub_1400010101.ll:7:29: error: expected type
; declare void @sub_140002790(ptr)
;                             ^
; === ERROR LOG END ===

; ModuleID = 'sub_140001010_module'
target triple = "x86_64-pc-windows-msvc"

declare i64 @llvm.read_register.i64(metadata)

declare void @sub_1400018D0()
declare void @sub_140002790(ptr)
declare void @sub_140002120()
declare i32 @sub_140001540()
declare void @sub_140001520()
declare void @sub_140001CA0(ptr)
declare i32 @sub_140002788(ptr, ptr)
declare i32 @sub_1400026A0(ptr, ptr, ptr, i32, ptr)
declare ptr @sub_1400027F8(i64)
declare i64 @sub_140002700(ptr)
declare void @sub_1400027B8(ptr, ptr, i64)
declare void @sub_140002780(ptr, ptr)
declare void @sub_1400027D0(i32)
declare ptr @sub_140002720()
declare ptr @sub_140002718()
declare void @sub_140002778(i32)
declare i32 @sub_140002670(i32)
declare void @sub_1400027A0(i32)
declare ptr @sub_140002660()
declare void @sub_140002880(i32, ptr, ptr)
declare void @sub_140002750()

declare void @sub_140001CB0()
declare void @nullsub_1()
declare void @sub_140001600()

@off_140004470 = external global ptr
@qword_140008280 = external global ptr
@off_140004480 = external global ptr
@dword_140007004 = external global i32
@off_1400043F0 = external global ptr
@qword_140007010 = external global ptr
@dword_140007020 = external global i32
@qword_140007018 = external global ptr
@dword_140007008 = external global i32
@qword_140008278 = external global ptr
@off_140004460 = external global ptr
@off_140004430 = external global ptr
@off_140004440 = external global ptr
@off_140004450 = external global ptr
@off_1400043C0 = external global ptr
@off_140004420 = external global ptr
@off_1400044F0 = external global ptr
@off_1400044D0 = external global ptr
@off_1400043A0 = external global ptr
@off_140004400 = external global ptr
@off_1400044C0 = external global ptr
@off_1400044B0 = external global ptr
@off_140004520 = external global ptr
@off_1400044E0 = external global ptr
@off_1400044A0 = external global ptr
@off_140004490 = external global ptr

define i32 @sub_140001010() {
entry:
  %var_4C = alloca i32, align 4
  %var_78 = alloca ptr, align 8
  %var_5C = alloca i32, align 4
  %retv = alloca i32, align 4
  store i32 0, ptr %retv, align 4
  %gsbase = call i64 @llvm.read_register.i64(metadata !"gsbase")
  %gsbase_ptr = inttoptr i64 %gsbase to ptr
  %tib_slot = getelementptr i8, ptr %gsbase_ptr, i64 48
  %teb = load ptr, ptr %tib_slot, align 8
  %owner_ptrptr = getelementptr i8, ptr %teb, i64 8
  %owner = load ptr, ptr %owner_ptrptr, align 8
  %rbx_base_ptr = load ptr, ptr @off_140004470
  %sleep_func = load ptr, ptr @qword_140008280
  br label %try_lock

try_lock:                                        ; preds = %sleep_then_retry, %entry
  %cmpx = cmpxchg ptr %rbx_base_ptr, ptr null, ptr %owner monotonic monotonic
  %oldval = extractvalue { ptr, i1 } %cmpx, 0
  %success = extractvalue { ptr, i1 } %cmpx, 1
  br i1 %success, label %lock_acquired, label %cmp_fail

cmp_fail:                                        ; preds = %try_lock
  %eq_ours = icmp eq ptr %oldval, %owner
  br i1 %eq_ours, label %already_owned, label %sleep_then_retry

sleep_then_retry:                                ; preds = %cmp_fail
  %sleep_cast = bitcast ptr %sleep_func to void (i32)*
  call void %sleep_cast(i32 1000)
  br label %try_lock

already_owned:                                   ; preds = %cmp_fail
  br label %post_lock_owned

lock_acquired:                                   ; preds = %try_lock
  br label %post_lock_owned

post_lock_owned:                                 ; preds = %lock_acquired, %already_owned
  %r14 = phi i32 [ 1, %already_owned ], [ 0, %lock_acquired ]
  %rbp_ptrptr = load ptr, ptr @off_140004480
  %rbp_val = load i32, ptr %rbp_ptrptr, align 4
  %is_one = icmp eq i32 %rbp_val, 1
  br i1 %is_one, label %state_one, label %check_zero

state_one:                                       ; preds = %post_lock_owned
  %tmp31 = call i32 @sub_140002670(i32 31)
  call void @sub_1400027A0(i32 %tmp31)
  unreachable

check_zero:                                      ; preds = %post_lock_owned
  %is_zero = icmp eq i32 %rbp_val, 0
  br i1 %is_zero, label %init_path, label %set_flag_and_continue

set_flag_and_continue:                           ; preds = %check_zero
  store i32 1, ptr @dword_140007004, align 4
  br label %after_set

init_path:                                       ; preds = %check_zero
  store i32 1, ptr %rbp_ptrptr, align 4
  call void @sub_1400018D0()
  %fptr_loader = load ptr, ptr @qword_140008278
  %fptr_cast = bitcast ptr %fptr_loader to ptr (ptr)*
  %cb = bitcast void ()* @sub_140001CB0 to ptr
  %ret_from_cbreg = call ptr %fptr_cast(ptr %cb)
  %off_4460 = load ptr, ptr @off_140004460
  store ptr %ret_from_cbreg, ptr %off_4460, align 8
  %ns = bitcast void ()* @nullsub_1 to ptr
  call void @sub_140002790(ptr %ns)
  call void @sub_140002120()
  %p_4430 = load ptr, ptr @off_140004430
  store i32 1, ptr %p_4430, align 4
  %p_4440 = load ptr, ptr @off_140004440
  store i32 1, ptr %p_4440, align 4
  %p_4450 = load ptr, ptr @off_140004450
  store i32 1, ptr %p_4450, align 4
  %p_43C0 = load ptr, ptr @off_1400043C0
  %mzw = load i16, ptr %p_43C0, align 2
  %is_MZ = icmp eq i16 %mzw, 23117
  br i1 %is_MZ, label %check_PE_hdr, label %set_ecx0

check_PE_hdr:                                    ; preds = %init_path
  %e_lfanew_ptr = getelementptr i8, ptr %p_43C0, i64 60
  %e_lfanew32 = load i32, ptr %e_lfanew_ptr, align 4
  %e_lfanew = sext i32 %e_lfanew32 to i64
  %nt_hdr = getelementptr i8, ptr %p_43C0, i64 %e_lfanew
  %pe_sig = load i32, ptr %nt_hdr, align 4
  %is_PE = icmp eq i32 %pe_sig, 17744
  br i1 %is_PE, label %check_opt_magic, label %set_ecx0

check_opt_magic:                                 ; preds = %check_PE_hdr
  %opt_magic_ptr = getelementptr i8, ptr %nt_hdr, i64 24
  %opt_magic16 = load i16, ptr %opt_magic_ptr, align 2
  %is_PE32 = icmp eq i16 %opt_magic16, 267
  br i1 %is_PE32, label %pe32_magic, label %check_pe32plus

check_pe32plus:                                  ; preds = %check_opt_magic
  %is_PE32plus = icmp eq i16 %opt_magic16, 523
  br i1 %is_PE32plus, label %pe32plus_path, label %set_ecx0

pe32plus_path:                                   ; preds = %check_pe32plus
  %soh_ptr = getelementptr i8, ptr %nt_hdr, i64 132
  %soh = load i32, ptr %soh_ptr, align 4
  %soh_cond = icmp ugt i32 %soh, 14
  br i1 %soh_cond, label %pe32plus_check_flag, label %set_ecx0

pe32plus_check_flag:                             ; preds = %pe32plus_path
  %flag_ptr = getelementptr i8, ptr %nt_hdr, i64 248
  %flag = load i32, ptr %flag_ptr, align 4
  %flag_nz = icmp ne i32 %flag, 0
  %ecx_from_flag = select i1 %flag_nz, i32 1, i32 0
  br label %after_pe_check

pe32_magic:                                      ; preds = %check_opt_magic
  %soh32_ptr = getelementptr i8, ptr %nt_hdr, i64 116
  %soh32 = load i32, ptr %soh32_ptr, align 4
  %soh32_cond = icmp ugt i32 %soh32, 14
  br i1 %soh32_cond, label %pe32_check_flag, label %set_ecx0

pe32_check_flag:                                 ; preds = %pe32_magic
  %flag32_ptr = getelementptr i8, ptr %nt_hdr, i64 232
  %flag32 = load i32, ptr %flag32_ptr, align 4
  %flag32_nz = icmp ne i32 %flag32, 0
  %ecx_from_flag32 = select i1 %flag32_nz, i32 1, i32 0
  br label %after_pe_check

set_ecx0:                                        ; preds = %pe32plus_path, %check_pe32plus, %check_PE_hdr, %init_path, %pe32_magic
  br label %after_pe_check

after_pe_check:                                  ; preds = %pe32_check_flag, %pe32plus_check_flag, %set_ecx0
  %ecx_phi = phi i32 [ %ecx_from_flag32, %pe32_check_flag ], [ %ecx_from_flag, %pe32plus_check_flag ], [ 0, %set_ecx0 ]
  %p_4420 = load ptr, ptr @off_140004420
  store i32 %ecx_phi, ptr @dword_140007008, align 4
  %r8d_val = load i32, ptr %p_4420, align 4
  %r8d_nz = icmp ne i32 %r8d_val, 0
  br i1 %r8d_nz, label %path_1338, label %cont_1

path_1338:                                       ; preds = %after_pe_check
  call void @sub_140002778(i32 2)
  br label %after_1DE

cont_1:                                          ; preds = %after_pe_check
  call void @sub_140002778(i32 1)
  br label %after_1DE

after_1DE:                                       ; preds = %cont_1, %path_1338
  %p_4F0 = load ptr, ptr @off_1400044F0
  %retptr1 = call ptr @sub_140002720()
  %val4f0 = load i32, ptr %p_4F0, align 4
  store i32 %val4f0, ptr %retptr1, align 4
  %p_4D0 = load ptr, ptr @off_1400044D0
  %retptr2 = call ptr @sub_140002718()
  %val4d0 = load i32, ptr %p_4D0, align 4
  store i32 %val4d0, ptr %retptr2, align 4
  %st = call i32 @sub_140001540()
  %neg = icmp slt i32 %st, 0
  br i1 %neg, label %error_1301, label %check_3a0

check_3a0:                                       ; preds = %after_1DE
  %p_3a0 = load ptr, ptr @off_1400043A0
  %val3a0 = load i32, ptr %p_3a0, align 4
  %is1_3a0 = icmp eq i32 %val3a0, 1
  br i1 %is1_3a0, label %call_1399, label %check_400

call_1399:                                       ; preds = %check_3a0
  %p_fun1600 = bitcast void ()* @sub_140001600 to ptr
  call void @sub_140001CA0(ptr %p_fun1600)
  br label %after_1399

after_1399:                                      ; preds = %call_1399
  br label %check_400

check_400:                                       ; preds = %after_1399, %check_3a0
  %p_400 = load ptr, ptr @off_140004400
  %val400 = load i32, ptr %p_400, align 4
  %is_m1 = icmp eq i32 %val400, -1
  br i1 %is_m1, label %call_138a, label %call_1230

call_138a:                                       ; preds = %check_400
  call void @sub_1400027D0(i32 -1)
  br label %call_1230

call_1230:                                       ; preds = %call_138a, %check_400
  %p_4C0 = load ptr, ptr @off_1400044C0
  %p_4B0 = load ptr, ptr @off_1400044B0
  %res788 = call i32 @sub_140002788(ptr %p_4B0, ptr %p_4C0)
  %nz = icmp ne i32 %res788, 0
  br i1 %nz, label %ret_ff, label %call_124b

ret_ff:                                          ; preds = %call_1230
  store i32 255, ptr %retv, align 4
  br label %early_return

call_124b:                                       ; preds = %call_1230
  %p_520 = load ptr, ptr @off_140004520
  %v520 = load i32, ptr %p_520, align 4
  store i32 %v520, ptr %var_4C, align 4
  %p_4E0 = load ptr, ptr @off_1400044E0
  %r9val = load i32, ptr %p_4E0, align 4
  store ptr %var_4C, ptr %var_78, align 8
  %rcx_arg = bitcast ptr @dword_140007020 to ptr
  %rdx_arg = bitcast ptr @qword_140007018 to ptr
  %r8_arg = bitcast ptr @qword_140007010 to ptr
  %arg5 = load ptr, ptr %var_78, align 8
  %res6A0 = call i32 @sub_1400026A0(ptr %rcx_arg, ptr %rdx_arg, ptr %r8_arg, i32 %r9val, ptr %arg5)
  %res6A0_neg = icmp slt i32 %res6A0, 0
  br i1 %res6A0_neg, label %error_1301, label %continue_after_6A0

continue_after_6A0:                              ; preds = %call_124b
  %count = load i32, ptr @dword_140007020, align 4
  %count64 = sext i32 %count to i64
  %plus1 = add i64 %count64, 1
  %bytes = shl i64 %plus1, 3
  %newarr = call ptr @sub_1400027F8(i64 %bytes)
  %isnull_newarr = icmp eq ptr %newarr, null
  br i1 %isnull_newarr, label %error_1301, label %maybe_loop

maybe_loop:                                      ; preds = %continue_after_6A0
  %le0 = icmp sle i32 %count, 0
  br i1 %le0, label %build_terminator, label %loop_prep

loop_prep:                                       ; preds = %maybe_loop
  %oldarr = load ptr, ptr @qword_140007018, align 8
  %i_init = add i64 0, 1
  br label %loop_cond

loop_cond:                                       ; preds = %after_copy, %loop_prep
  %i = phi i64 [ %i_init, %loop_prep ], [ %i_next, %after_copy ]
  %idx0 = add i64 %i, -1
  %src_off = mul i64 %idx0, 8
  %srcptr_addr = getelementptr i8, ptr %oldarr, i64 %src_off
  %srcptr = load ptr, ptr %srcptr_addr, align 8
  %len = call i64 @sub_140002700(ptr %srcptr)
  %len1 = add i64 %len, 1
  %buf = call ptr @sub_1400027F8(i64 %len1)
  %dst_off = mul i64 %idx0, 8
  %dst_addr = getelementptr i8, ptr %newarr, i64 %dst_off
  store ptr %buf, ptr %dst_addr, align 8
  %isnull_buf = icmp eq ptr %buf, null
  br i1 %isnull_buf, label %error_1301, label %do_copy

do_copy:                                         ; preds = %loop_cond
  call void @sub_1400027B8(ptr %buf, ptr %srcptr, i64 %len1)
  %i64_count = sext i32 %count to i64
  %eq_last = icmp eq i64 %i64_count, %i
  br i1 %eq_last, label %last_elem, label %after_copy

after_copy:                                      ; preds = %do_copy
  %i_next = add i64 %i, 1
  br label %loop_cond

last_elem:                                       ; preds = %do_copy
  %endoff = mul i64 %i64_count, 8
  %endptr = getelementptr i8, ptr %newarr, i64 %endoff
  br label %build_terminator_from_rax

build_terminator:                                ; preds = %maybe_loop
  %i64_count2 = sext i32 %count to i64
  %endoff2 = mul i64 %i64_count2, 8
  %endptr2 = getelementptr i8, ptr %newarr, i64 %endoff2
  br label %build_terminator_from_rax

build_terminator_from_rax:                       ; preds = %build_terminator, %last_elem
  %endphi = phi ptr [ %endptr, %last_elem ], [ %endptr2, %build_terminator ]
  store ptr null, ptr %endphi, align 8
  %p_4A0 = load ptr, ptr @off_1400044A0
  %p_490 = load ptr, ptr @off_140004490
  store ptr %newarr, ptr @qword_140007018, align 8
  call void @sub_140002780(ptr %p_490, ptr %p_4A0)
  call void @sub_140001520()
  store i32 2, ptr %rbp_ptrptr, align 4
  br label %after_set

after_set:                                       ; preds = %build_terminator_from_rax, %set_flag_and_continue
  %r14_is_zero = icmp eq i32 %r14, 0
  br i1 %r14_is_zero, label %release_lock, label %continue_no_release

release_lock:                                    ; preds = %after_set
  %old_release = atomicrmw xchg ptr %rbx_base_ptr, ptr null monotonic
  br label %cont_108d

continue_no_release:                             ; preds = %after_set
  br label %cont_108d

cont_108d:                                       ; preds = %continue_no_release, %release_lock
  %p_43F0 = load ptr, ptr @off_1400043F0
  %f_slot = load ptr, ptr %p_43F0, align 8
  %has_func = icmp ne ptr %f_slot, null
  br i1 %has_func, label %call_slot, label %after_slot

call_slot:                                       ; preds = %cont_108d
  %slot_cast = bitcast ptr %f_slot to void (i32, i32, i32)*
  call void %slot_cast(i32 0, i32 2, i32 0)
  br label %after_slot

after_slot:                                      ; preds = %call_slot, %cont_108d
  %p_ret = call ptr @sub_140002660()
  %val_q7010 = load ptr, ptr @qword_140007010, align 8
  store ptr %val_q7010, ptr %p_ret, align 8
  %ecx_val2 = load i32, ptr @dword_140007020, align 4
  %rdx_val2 = load ptr, ptr @qword_140007018, align 8
  %r8_val2 = load ptr, ptr @qword_140007010, align 8
  call void @sub_140002880(i32 %ecx_val2, ptr %rdx_val2, ptr %r8_val2)
  %ecx_g = load i32, ptr @dword_140007008, align 4
  %ecx_zero = icmp eq i32 %ecx_g, 0
  br i1 %ecx_zero, label %call_3d2, label %check_7004

check_7004:                                      ; preds = %after_slot
  %edx_g = load i32, ptr @dword_140007004, align 4
  %edx_zero = icmp eq i32 %edx_g, 0
  br i1 %edx_zero, label %path_1310, label %epilogue_return

error_1301:                                      ; preds = %continue_after_6A0, %loop_cond, %continue_after_6A0, %after_1DE
  %errcode = call i32 @sub_140002670(i32 8)
  store i32 %errcode, ptr %var_5C, align 4
  call void @sub_140002750()
  %eax_from_stack = load i32, ptr %var_5C, align 4
  store i32 %eax_from_stack, ptr %retv, align 4
  br label %early_return

path_1310:                                       ; preds = %check_7004
  %cur_rv = load i32, ptr %retv, align 4
  store i32 %cur_rv, ptr %var_5C, align 4
  call void @sub_140002750()
  %rv2 = load i32, ptr %var_5C, align 4
  store i32 %rv2, ptr %retv, align 4
  br label %early_return

call_3d2:                                        ; preds = %after_slot
  %rv3 = load i32, ptr %retv, align 4
  call void @sub_1400027A0(i32 %rv3)
  unreachable

epilogue_return:                                 ; preds = %check_7004
  %final = load i32, ptr %retv, align 4
  ret i32 %final

early_return:                                    ; preds = %path_1310, %error_1301, %ret_ff
  %final2 = load i32, ptr %retv, align 4
  ret i32 %final2
}